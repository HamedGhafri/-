<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="fade">

  <div class="top-bar">â­ Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª</div>
  <button id="modeToggle" onclick="toggleMode()">ğŸŒ“</button>

  <div class="container">
    <a class="btn" href="index.html" style="margin-bottom:12px">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</a>

    <h1>Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª</h1>

    <div id="favList"></div>
  </div>

<script>
function toggleMode() {
  document.body.classList.toggle('dark');
  localStorage.setItem('darkMode', document.body.classList.contains('dark'));
}
if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark');

function getFavorites() {
  try {
    const v = JSON.parse(localStorage.getItem('favoritePoems')||'[]');
    return Array.isArray(v)?v:[];
  } catch { return []; }
}

async function renderFavorites() {
  const fav = getFavorites();
  const res = await fetch('poems.txt');
  const text = await res.text();
  const poems = text.split('===\n').map(p=>p.trim()).filter(p=>p);
  const container = document.getElementById('favList');
  container.innerHTML = '';
  if (!fav.length) {
    container.innerHTML = '<p style="opacity:.8">Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ù‚ØµÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª Ø¨Ø¹Ø¯.</p>';
    return;
  }
  fav.forEach(id => {
    const i = Number(id);
    if (isNaN(i) || i<0 || i>=poems.length) return;
    const lines = poems[i].split('\n').map(l=>l.trim()).filter(l=>l);
    const title = lines[0] || `Ù‚ØµÙŠØ¯Ø© ${i+1}`;
    container.innerHTML += `
      <a class="poem-card" href="viewer.html?id=${i}">
        <div class="title">${escapeHtml(title)}</div>
        <div style="margin-top:8px">
          <button class="btn" onclick="removeFav(event, ${i})">Ø­Ø°Ù</button>
        </div>
      </a>
    `;
  });
}

function removeFav(e, id) {
  e.preventDefault();
  const fav = getFavorites();
  const idx = fav.indexOf(Number(id));
  if (idx !== -1) fav.splice(idx,1);
  localStorage.setItem('favoritePoems', JSON.stringify(fav));
  renderFavorites();
}

function escapeHtml(s) { if (!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

renderFavorites();
</script>

</body>
</html>
