<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ… - Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†">
    <title>Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ… | Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=1.7">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>

    <nav class="navbar">
        <div class="container">
            <div class="nav-brand"><i class="fas fa-book-open"></i><span>Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†</span></div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="categories.html"><i class="fas fa-layer-group"></i> Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a></li>
                <li><a href="search.html"><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø«</a></li>
                <li><a href="verse-of-the-day.html" class="active"><i class="fas fa-star"></i> Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ…</a></li>
                <li><a href="about.html"><i class="fas fa-user"></i> Ø¹Ù† Ø§Ù„Ø´Ø§Ø¹Ø±</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle"><i class="fas fa-bars"></i></button>
        </div>
    </nav>

    <main class="container main-content">
        <section class="verse-section">
            <div class="section-header">
                <h1><i class="fas fa-star"></i> Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ…</h1>
                <p class="section-subtitle">Ø¨ÙŠØª Ø´Ø¹Ø±ÙŠ Ù…Ù…ÙŠØ² ÙŠØªØ¬Ø¯Ø¯ ÙƒÙ„ ÙŠÙˆÙ…</p>
            </div>

            <div class="verse-card-container" id="verseContainer">
                <div class="loading-container">
                    <div class="loader"></div>
                    <p>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
            </div>

            <!-- Hidden canvas for image generation -->
            <canvas id="verseCanvas" style="display: none;"></canvas>

            <div class="actions-container">
                <button class="action-btn primary-action" id="shareImageBtn">
                    <i class="fas fa-share-alt"></i>
                    Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø©
                </button>
                <button class="action-btn secondary-action" id="downloadBtn">
                    <i class="fas fa-download"></i>
                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                </button>
                <button class="action-btn secondary-action" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i>
                    Ø¨ÙŠØª Ø¢Ø®Ø±
                </button>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
        </div>
    </footer>

    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>


    <script src="script.js"></script>
    <script>
        let allVerses = [];
        let currentVerse = null;

        document.addEventListener('DOMContentLoaded', async function() {
            // Disable right-click on verse card
            document.addEventListener('contextmenu', function(e) {
                if (e.target.closest('.verse-card')) {
                    e.preventDefault();
                    showToast('Ø§Ù„Ù†Ø³Ø® ØºÙŠØ± Ù…ØªØ§Ø­ - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø©');
                }
            });

            // Disable copy shortcuts
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'C')) {
                    if (window.getSelection().toString() && 
                        window.getSelection().anchorNode.closest('.verse-card')) {
                        e.preventDefault();
                        showToast('Ø§Ù„Ù†Ø³Ø® ØºÙŠØ± Ù…ØªØ§Ø­ - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø©');
                    }
                }
            });

            await loadVerses();
            displayVerseOfTheDay();

            document.getElementById('shareImageBtn')?.addEventListener('click', shareAsImage);
            document.getElementById('downloadBtn')?.addEventListener('click', downloadImage);
            document.getElementById('refreshBtn')?.addEventListener('click', getRandomVerse);
        });

        async function loadVerses() {
            try {
                const response = await fetch('poems.txt');
                const text = await response.text();
                const poems = parsePoems(text);
                
                // Extract all verses
                poems.forEach(poem => {
                    poem.verses.forEach(verse => {
                        allVerses.push({
                            text: verse,
                            author: 'Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†',
                            poemTitle: poem.title
                        });
                    });
                });
            } catch (error) {
                console.error('Error loading verses:', error);
            }
        }

        function parsePoems(text) {
            const poemBlocks = text.split('===').filter(block => block.trim());
            const poemsArray = [];
            
            for (let block of poemBlocks) {
                const lines = block.trim().split('\n').filter(line => line.trim());
                if (lines.length === 0) continue;
                
                const title = lines[0].trim();
                let startIndex = 1;
                
                if (lines.length > 1 && lines[1].trim().startsWith('@')) {
                    startIndex = 2;
                }
                
                const verses = [];
                let currentVerse = [];
                
                for (let i = startIndex; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        currentVerse.push(line);
                        if (currentVerse.length === 2) {
                            verses.push(currentVerse.join('\n'));
                            currentVerse = [];
                        }
                    }
                }
                
                if (currentVerse.length > 0) {
                    verses.push(currentVerse.join('\n'));
                }
                
                poemsArray.push({ title, verses });
            }
            
            return poemsArray;
        }

        function displayVerseOfTheDay() {
            // Get verse based on date (consistent for the day)
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const verseIndex = dayOfYear % allVerses.length;
            
            currentVerse = allVerses[verseIndex];
            displayVerse();
        }

        function getRandomVerse() {
            const randomIndex = Math.floor(Math.random() * allVerses.length);
            currentVerse = allVerses[randomIndex];
            displayVerse();
        }

        function displayVerse() {
            const container = document.getElementById('verseContainer');
            const today = new Date().toLocaleDateString('ar-SA', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            container.innerHTML = `
                <div class="verse-card">
                    <div class="verse-ornament">âœ¦ â âœ¦</div>
                    <div class="verse-text">${currentVerse.text}</div>
                    <div class="verse-author">
                        <i class="fas fa-feather-alt"></i>
                        <span>${currentVerse.author}</span>
                    </div>
                    <div class="verse-date">${today}</div>
                    <div class="watermark">Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†</div>
                </div>
            `;
        }

        async function shareAsImage() {
            const imageBlob = await generateImage();
            
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [new File([imageBlob], 'verse.png', { type: 'image/png' })] })) {
                try {
                    const file = new File([imageBlob], 'Ø¨ÙŠØª_Ø§Ù„ÙŠÙˆÙ….png', { type: 'image/png' });
                    await navigator.share({
                        title: 'Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ…',
                        text: 'Ø¨ÙŠØª Ø´Ø¹Ø±ÙŠ Ù…Ù† Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†',
                        files: [file]
                    });
                    showToast('ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.error('Share failed:', err);
                        downloadImageFromBlob(imageBlob);
                    }
                }
            } else {
                downloadImageFromBlob(imageBlob);
            }
        }

        async function downloadImage() {
            const imageBlob = await generateImage();
            downloadImageFromBlob(imageBlob);
        }

        function downloadImageFromBlob(blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Ø¨ÙŠØª_Ø§Ù„ÙŠÙˆÙ…_' + new Date().getTime() + '.png';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©');
        }

        async function generateImage() {
            const canvas = document.getElementById('verseCanvas');
            const ctx = canvas.getContext('2d');
            
            // Polyfill for roundRect (for older browsers)
            if (!ctx.roundRect) {
                ctx.roundRect = function(x, y, w, h, r) {
                    if (w < 2 * r) r = w / 2;
                    if (h < 2 * r) r = h / 2;
                    this.beginPath();
                    this.moveTo(x + r, y);
                    this.arcTo(x + w, y, x + w, y + h, r);
                    this.arcTo(x + w, y + h, x, y + h, r);
                    this.arcTo(x, y + h, x, y, r);
                    this.arcTo(x, y, x + w, y, r);
                    this.closePath();
                    return this;
                };
            }
            
            // Set canvas size (optimized for Instagram/Social Media)
            canvas.width = 1080;
            canvas.height = 1350;

            // Get current theme
            const isDark = document.body.classList.contains('dark-mode');
            
            // Design 2: Elegant Beige & Rose Gold Palette
            const colors = {
                bg1: isDark ? '#2a2438' : '#f5ede4',        // Beige/Purple
                bg2: isDark ? '#3d2f4d' : '#fef8f3',        // Cream/Purple
                bg3: isDark ? '#352947' : '#fff9f0',        // Warm/Purple
                primary: '#c9a063',      // Rose Gold
                secondary: '#d4af6e',    // Champagne Gold
                text: isDark ? '#f5f5f5' : '#2d2424',
                textLight: isDark ? '#d0d0d0' : '#6b5d5d',
                accent: '#d4a574',       // Light Gold
                shadow: isDark ? 'rgba(0,0,0,0.5)' : 'rgba(139,105,20,0.15)'
            };

            // Draw elegant gradient background
            const bgGradient = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, 0,
                canvas.width / 2, canvas.height / 2, canvas.height * 0.8
            );
            bgGradient.addColorStop(0, colors.bg2);
            bgGradient.addColorStop(0.6, colors.bg1);
            bgGradient.addColorStop(1, colors.bg3);
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw delicate mandala patterns in corners
            ctx.globalAlpha = 0.08;
            ctx.fillStyle = colors.primary;
            
            // Top corners mandalas
            for (let i = 0; i < 12; i++) {
                const angle = (i * 30) * Math.PI / 180;
                const radius = 150;
                const x1 = 150 + Math.cos(angle) * radius;
                const y1 = 150 + Math.sin(angle) * radius;
                ctx.beginPath();
                ctx.arc(x1, y1, 8, 0, Math.PI * 2);
                ctx.fill();
                
                const x2 = canvas.width - 150 + Math.cos(angle) * radius;
                const y2 = 150 + Math.sin(angle) * radius;
                ctx.beginPath();
                ctx.arc(x2, y2, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.globalAlpha = 1;

            // Draw main content card with shadow
            const cardMargin = 60;
            const cardX = cardMargin;
            const cardY = cardMargin;
            const cardW = canvas.width - (cardMargin * 2);
            const cardH = canvas.height - (cardMargin * 2);
            const cardRadius = 30;

            // Card shadow
            ctx.shadowColor = colors.shadow;
            ctx.shadowBlur = 40;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 10;

            // Card background
            ctx.fillStyle = isDark ? 'rgba(26, 26, 46, 0.95)' : 'rgba(255, 255, 255, 0.98)';
            ctx.beginPath();
            ctx.roundRect(cardX, cardY, cardW, cardH, cardRadius);
            ctx.fill();

            // Reset shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;

            // Draw elegant double border with rose gold
            const borderGradient = ctx.createLinearGradient(cardX, cardY, cardX + cardW, cardY + cardH);
            borderGradient.addColorStop(0, colors.primary);
            borderGradient.addColorStop(0.5, colors.accent);
            borderGradient.addColorStop(1, colors.secondary);
            
            // Outer border
            ctx.strokeStyle = borderGradient;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.roundRect(cardX + 15, cardY + 15, cardW - 30, cardH - 30, cardRadius - 5);
            ctx.stroke();
            
            // Inner border
            ctx.lineWidth = 1.5;
            ctx.globalAlpha = 0.6;
            ctx.beginPath();
            ctx.roundRect(cardX + 25, cardY + 25, cardW - 50, cardH - 50, cardRadius - 10);
            ctx.stroke();
            ctx.globalAlpha = 1;

            // Draw delicate floral corner ornaments
            const drawFlowerOrnament = (x, y, rotation) => {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(rotation * Math.PI / 180);
                ctx.strokeStyle = colors.accent;
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                
                // Flower petals
                for (let i = 0; i < 6; i++) {
                    const angle = (i * 60) * Math.PI / 180;
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    const x1 = Math.cos(angle) * 35;
                    const y1 = Math.sin(angle) * 35;
                    ctx.lineTo(x1, y1);
                    ctx.stroke();
                    
                    // Petal tip
                    ctx.beginPath();
                    ctx.arc(x1, y1, 5, 0, Math.PI * 2);
                    ctx.fillStyle = colors.primary;
                    ctx.globalAlpha = 0.3;
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
                
                ctx.restore();
            };
            
            // Draw flowers in corners
            drawFlowerOrnament(cardX + 50, cardY + 50, 0);
            drawFlowerOrnament(cardX + cardW - 50, cardY + 50, 90);
            drawFlowerOrnament(cardX + 50, cardY + cardH - 50, 270);
            drawFlowerOrnament(cardX + cardW - 50, cardY + cardH - 50, 180);

            // Draw elegant title banner with gradient
            const titleGradient = ctx.createLinearGradient(cardX + 80, 0, cardX + cardW - 80, 0);
            titleGradient.addColorStop(0, colors.primary);
            titleGradient.addColorStop(0.5, colors.accent);
            titleGradient.addColorStop(1, colors.secondary);
            
            ctx.fillStyle = titleGradient;
            ctx.shadowColor = colors.shadow;
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 5;
            ctx.beginPath();
            ctx.roundRect(cardX + 100, cardY + 90, cardW - 200, 85, 42);
            ctx.fill();
            
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;

            // Title text
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 46px Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ…', canvas.width / 2, cardY + 132);

            // Draw delicate ornamental divider
            ctx.fillStyle = colors.accent;
            ctx.font = '42px Arial';
            ctx.fillText('âœ¦ â âœ¦', canvas.width / 2, cardY + 220);

            // Draw verse text with beautiful typography
            ctx.fillStyle = colors.text;
            ctx.font = 'bold 52px Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const verseLines = currentVerse.text.split('\n');
            let y = cardY + 350;
            const lineHeight = 90;
            const maxWidth = cardW - 200;
            
            verseLines.forEach((line, index) => {
                // Add subtle shadow to text for depth
                ctx.shadowColor = colors.shadow;
                ctx.shadowBlur = 3;
                ctx.shadowOffsetY = 2;
                
                // Handle long lines with word wrapping
                const words = line.split(' ');
                let currentLine = '';
                const lines = [];
                
                for (let word of words) {
                    const testLine = currentLine + word + ' ';
                    const metrics = ctx.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine !== '') {
                        lines.push(currentLine.trim());
                        currentLine = word + ' ';
                    } else {
                        currentLine = testLine;
                    }
                }
                if (currentLine) {
                    lines.push(currentLine.trim());
                }
                
                // Draw each line
                lines.forEach(textLine => {
                    ctx.fillText(textLine, canvas.width / 2, y);
                    y += lineHeight;
                });
                
                // Add space between verse hemistichs
                if (index < verseLines.length - 1) {
                    y += 30;
                }
            });
            
            // Reset shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;

            // Draw elegant separator with rose gold gradient
            y += 60;
            const separatorY = y;
            
            // Decorative line with soft gradient
            const lineGradient = ctx.createLinearGradient(220, separatorY, canvas.width - 220, separatorY);
            lineGradient.addColorStop(0, 'transparent');
            lineGradient.addColorStop(0.25, colors.primary);
            lineGradient.addColorStop(0.5, colors.accent);
            lineGradient.addColorStop(0.75, colors.secondary);
            lineGradient.addColorStop(1, 'transparent');
            
            ctx.strokeStyle = lineGradient;
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(200, separatorY);
            ctx.lineTo(canvas.width - 200, separatorY);
            ctx.stroke();
            
            // Center ornament with glow effect
            ctx.shadowColor = colors.primary;
            ctx.shadowBlur = 10;
            ctx.fillStyle = colors.accent;
            ctx.font = 'bold 36px Arial';
            ctx.fillText('âœ¦', canvas.width / 2, separatorY);
            ctx.shadowBlur = 0;

            // Draw author section with icon
            y += 80;
            
            // Author background
            ctx.fillStyle = colors.primary;
            ctx.globalAlpha = 0.1;
            ctx.beginPath();
            ctx.roundRect(canvas.width / 2 - 250, y - 40, 500, 70, 35);
            ctx.fill();
            ctx.globalAlpha = 1;
            
            // Author text with gradient
            const authorGradient = ctx.createLinearGradient(0, y - 20, 0, y + 20);
            authorGradient.addColorStop(0, colors.primary);
            authorGradient.addColorStop(1, colors.secondary);
            ctx.fillStyle = authorGradient;
            ctx.font = 'bold 44px Arial, sans-serif';
            ctx.fillText('âœ’ ' + currentVerse.author, canvas.width / 2, y);

            // Draw date with elegant styling (Gregorian calendar)
            y += 100;
            const today = new Date().toLocaleDateString('ar-EG', { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            ctx.fillStyle = colors.textLight;
            ctx.font = '34px Arial, sans-serif';
            ctx.fillText(today, canvas.width / 2, y);

            // Draw poem title if available
            if (currentVerse.poemTitle) {
                y += 70;
                ctx.fillStyle = colors.textLight;
                ctx.font = 'italic 30px Arial, sans-serif';
                ctx.fillText('Ù…Ù† Ù‚ØµÙŠØ¯Ø©: ' + currentVerse.poemTitle, canvas.width / 2, y);
            }

            // Draw elegant footer section
            const footerY = cardY + cardH - 110;
            
            // Delicate footer divider with gradient
            const footerLineGradient = ctx.createLinearGradient(cardX + 120, footerY - 35, cardX + cardW - 120, footerY - 35);
            footerLineGradient.addColorStop(0, 'transparent');
            footerLineGradient.addColorStop(0.5, colors.primary);
            footerLineGradient.addColorStop(1, 'transparent');
            ctx.strokeStyle = footerLineGradient;
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.4;
            ctx.beginPath();
            ctx.moveTo(cardX + 120, footerY - 35);
            ctx.lineTo(cardX + cardW - 120, footerY - 35);
            ctx.stroke();
            ctx.globalAlpha = 1;

            // Draw watermark with elegant styling
            const watermarkGradient = ctx.createLinearGradient(0, footerY - 10, 0, footerY + 10);
            watermarkGradient.addColorStop(0, colors.primary);
            watermarkGradient.addColorStop(1, colors.secondary);
            ctx.fillStyle = watermarkGradient;
            ctx.font = 'bold 34px Arial, sans-serif';
            ctx.fillText('ğŸ“– Ù…Ù‚ØªØ·ÙØ§Øª Ø§Ø¨Ù† Ø­Ù…Ø¯Ø§Ù†', canvas.width / 2, footerY);
            
            // Website URL with refined style
            ctx.fillStyle = colors.textLight;
            ctx.globalAlpha = 0.7;
            ctx.font = '24px Arial, sans-serif';
            ctx.fillText('hamedghafri.github.io', canvas.width / 2, footerY + 45);
            ctx.globalAlpha = 1;

            // Convert to blob
            return new Promise(resolve => {
                canvas.toBlob(blob => resolve(blob));
            });
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
