<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع قصائد حمد الغافري</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 class="title">موقع قصائد حمد الغافري</h1>

<h2 class="subtitle">القصائد</h2>

<div id="poems" class="list">جاري التحميل...</div>

<script>
    function cleanArabicFilename(name) {
        return decodeURIComponent(name)
            .replace('.txt', '')
            .replace(/[؟،:;'".!]/g, '')  // إزالة الرموز
            .replace(/\s+/g, ' ')        // مسافات طبيعية
            .trim();
    }

    async function loadPoems() {
        try {
            // قراءة قائمة الملفات من المجلد
            const res = await fetch('poems/');
            const html = await res.text();

            // استخراج أسماء الملفات
            const files = [...html.matchAll(/href="([^"]+\.txt)"/g)]
                .map(m => m[1]);

            const container = document.getElementById("poems");
            container.innerHTML = "";

            files.forEach(file => {
                const title = cleanArabicFilename(file).replace(/-/g, ' ');

                const link = document.createElement("a");
                link.href = `viewer.html?file=${file}`;
                link.className = "poem-link";
                link.textContent = title;

                container.appendChild(link);
            });

        } catch (err) {
            document.getElementById("poems").textContent = "خطأ في تحميل القصائد.";
        }
    }

    loadPoems();
</script>

</body>
</html>
