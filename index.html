<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙŠÙˆØ§Ù† Ø­Ù…Ø¯ Ø§Ù„ØºØ§ÙØ±ÙŠ</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="top-bar">
    <h2>Ø¯ÙŠÙˆØ§Ù† Ø­Ù…Ø¯ Ø§Ù„ØºØ§ÙØ±ÙŠ</h2>
</div>

<div class="container">

    <div class="actions">
        <button onclick="randomPoem()" class="btn">Ù‚ØµÙŠØ¯Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ğŸ²</button>
        <a href="about.html" class="btn">Ø¹Ù† Ø§Ù„Ø´Ø§Ø¹Ø± ğŸ‘¤</a>
    </div>

    <input id="search" class="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚ØµÙŠØ¯Ø©..." oninput="filterPoems()">

    <h3 class="section-title">ğŸ“Œ Ø¨ÙŠØª Ø§Ù„ÙŠÙˆÙ…</h3>
    <div id="todayBox" class="today-box">
        <div id="todayContent"></div>
    </div>

    <h3 class="section-title">ğŸ“š ÙÙ‡Ø±Ø³ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯</h3>
    <div id="list" class="poem-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script>
let poemList = [];
let allLines = [];

async function loadPoems() {
    try {
        const res = await fetch("poems.txt");
        if (!res.ok) {
            document.getElementById('list').innerHTML = '<p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ (Ø±Ø§Ø¬Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ÙˆÙ…Ø³Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„).</p>';
            return;
        }
        const text = await res.text();

        const poems = text.split("===\n").map(p => p.trim()).filter(p => p);

        poemList = poems.map((poem, i) => ({
            id: i,
            title: poem.split("\n")[0].trim()
        }));

        // **ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ø®Ø·Ø£ Ù‡Ù†Ø§**: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­
        display(poemList);

        poems.forEach(poem => {
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙŠØºØ© ØªØ­ØªÙˆÙŠ Ø³Ø·Ø± ØªØµÙ†ÙŠÙ (line 2) ÙØ¥Ù†Ù†Ø§ Ù†Ø£Ø®Ø° Ø§Ù„Ø£Ø¨ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø±ÙŠÙ†
            // Ù‡Ø°Ø§ ÙŠØªÙ…Ø§Ø´Ù‰ Ù…Ø¹ ØªÙ†Ø³ÙŠÙ‚: Ø¹Ù†ÙˆØ§Ù† / @ØªØµÙ†ÙŠÙ / Ø£Ø¨ÙŠØ§Øª...
            const lines = poem.split("\n").slice(2).filter(l => l.trim());
            allLines.push(...lines);
        });

        showBaytOfDay();
    } catch (err) {
        console.error(err);
        document.getElementById('list').innerHTML = '<p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ØµØ§Ø¦Ø¯. Ø§ÙØªØ­ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… (Console) Ù„Ù„Ù…Ø²ÙŠØ¯.</p>';
    }
}

function display(arr) {
    const list = document.getElementById("list");
    list.innerHTML = "";

    if (!arr || arr.length === 0) {
        list.innerHTML = '<p style="opacity:.8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØ§Ø¦Ø¯.</p>';
        return;
    }

    arr.forEach(p => {
        list.innerHTML += `
            <a class="poem-card" href="viewer.html?id=${p.id}">
                ${escapeHtml(p.title)}
            </a>
        `;
    });
}

function filterPoems() {
    const text = document.getElementById("search").value.trim().toLowerCase();
    if (!text) {
        display(poemList);
        return;
    }
    display(poemList.filter(p => (p.title || '').toLowerCase().includes(text)));
}

function randomPoem() {
    if (!poemList.length) return;
    const id = Math.floor(Math.random() * poemList.length);
    window.location.href = `viewer.html?id=${id}`;
}

function showBaytOfDay() {
    if (!allLines.length) {
        document.getElementById("todayContent").innerHTML = '';
        return;
    }
    const today = new Date().getDate();
    const i = today % allLines.length;
    document.getElementById("todayContent").innerHTML = `
        ${escapeHtml(allLines[i])}<br>${escapeHtml(allLines[i+1] || "")}
    `;
}

function escapeHtml(s) {
    if (!s) return '';
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

loadPoems();
</script>

</body>
</html>
