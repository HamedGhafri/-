<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ديوان حمد الغافري</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

    <h1>ديوان حمد الغافري</h1>

    <!-- buttons -->
    <div class="actions">
        <a class="btn btn-today" href="#" onclick="poemOfTheDay()">قصيدة اليوم</a>
        <a class="btn" href="#" onclick="randomPoem()">قصيدة عشوائية</a>
        <a class="btn" href="about.html">عن الشاعر</a>
    </div>

    <!-- search -->
    <input type="text" id="search" placeholder="ابحث عن قصيدة..." oninput="filterPoems()">

    <!-- Poem of the Day box -->
    <div id="todayBox" style="display:none;" class="today-box">
        <div id="todayTitle" class="today-title"></div>
        <div id="todayContent"></div>
    </div>

    <!-- poems list -->
    <div id="list">جاري التحميل...</div>

</div>

<script>
let poemList = [];

async function loadPoems() {
    const res = await fetch("poems.txt");
    const text = await res.text();
    const poems = text.split("===\n").map(p => p.trim()).filter(p => p);

    poemList = poems.map((poem, index) => {
        return {
            id: index,
            title: poem.split("\n")[0].trim()
        };
    });

    display(poemList);
}

function display(arr) {
    const list = document.getElementById("list");
    list.innerHTML = "";

    arr.forEach(poem => {
        list.innerHTML += `
            <a class="poem-card" href="viewer.html?id=${poem.id}">
                ${poem.title}
            </a>
        `;
    });
}

function filterPoems() {
    const text = document.getElementById("search").value.trim();
    const filtered = poemList.filter(p => p.title.includes(text));
    display(filtered);
}

function randomPoem() {
    const id = Math.floor(Math.random() * poemList.length);
    window.location.href = `viewer.html?id=${id}`;
}

function poemOfTheDay() {
    const today = new Date().getDate(); 
    const id = today % poemList.length;

    fetch("poems.txt")
        .then(res => res.text())
        .then(text => {
            const poems = text.split("===\n").map(p => p.trim()).filter(p => p);
            const full = poems[id].split("\n");

            const title = full[0];
            const content = full.slice(1).join("<br>");

            document.getElementById("todayTitle").innerHTML = title;
            document.getElementById("todayContent").innerHTML = content;

            document.getElementById("todayBox").style.display = "block";
            window.scrollTo({ top: 300, behavior: "smooth" });
        });
}

loadPoems();
</script>

</body>
</html>
